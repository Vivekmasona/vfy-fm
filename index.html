<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Single Audio Player with Session Management</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    <style>
        #audioPlayerContainer {
            width: 40px;
            height: 40px;
            z-index: 99999;
            border-radius: 50%;
            background-color: #333;
            display: flex;
            align-items: center;
            justify-content: center;
            position: fixed;
            bottom: 10px;
            right: 20px;
            cursor: pointer;
        }

        #playPauseButton {
            width: 20px;
            height: 20px;
            fill: white;
        }

        .glow {
            animation: glow 1s ease-in-out infinite alternate;
        }

        @keyframes glow {
            0% { box-shadow: 0 0 10px rgba(255, 0, 0, 0.5); }
            20% { box-shadow: 0 0 20px rgba(0, 128, 0, 0.5); }
            40% { box-shadow: 0 0 20px rgba(255, 192, 203, 0.5); }
            60% { box-shadow: 0 0 20px rgba(0, 0, 255, 0.5); }
            80% { box-shadow: 0 0 20px rgba(255, 255, 0, 0.5); }
            100% { box-shadow: 0 0 20px rgba(255, 255, 255, 0.5); }
        }

        #sessionInfoContainer {
            position: fixed;
            left: 10px;
            bottom: 10px;
            background-color: rgba(0, 0, 0, 0.7);
            color: white;
            padding: 5px 10px;
            border-radius: 5px;
            display: none;
            align-items: center;
        }

        .wifiIcon {
            color: #fff;
            margin-right: 5px;
        }
    </style>
</head>
<body>

<div id="audioPlayerContainer">
    <svg id="playPauseButton" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
        <path id="playIcon" d="M8 5v14l11-7z"></path>
    </svg>
</div>

<div id="sessionInfoContainer">
    <i class="wifiIcon fas fa-wifi"></i>
    <span id="sessionId"></span>
    <button id="renameSessionIdButton" style="margin-left: 5px;">Rename</button>
</div>

<audio id="audioPlayer"></audio>

<script>
    document.addEventListener('DOMContentLoaded', function () {
        const audioPlayer = document.getElementById('audioPlayer');
        const audioPlayerContainer = document.getElementById('audioPlayerContainer');
        const playPauseButton = document.getElementById('playPauseButton');
        const playIcon = document.getElementById('playIcon');
        const sessionInfoContainer = document.getElementById('sessionInfoContainer');
        const sessionIdElement = document.getElementById('sessionId');
        const renameSessionIdButton = document.getElementById('renameSessionIdButton');
        let sessionId = localStorage.getItem('sessionId');
        let isPlaying = false;

        // Generate a session ID if not already present
        if (!sessionId) {
            sessionId = generateSessionId();
            localStorage.setItem('sessionId', sessionId);
        }

        sessionIdElement.textContent = sessionId;

        // Function to generate session ID
        function generateSessionId() {
            return Math.random().toString(36).substring(2, 15) + Math.random().toString(36).substring(2, 15);
        }

        playPauseButton.onclick = () => {
            if (isPlaying) {
                audioPlayer.pause();
            } else {
                audioPlayer.play();
            }
        };

        function updatePlayPauseIcon() {
            if (audioPlayer.paused) {
                playIcon.setAttribute('d', 'M8 5v14l11-7z'); // Play icon
                isPlaying = false;
                audioPlayerContainer.classList.remove('glow'); // Remove glow class
            } else {
                playIcon.setAttribute('d', 'M6 19h4V5H6zm8-14v14h4V5z'); // Pause icon
                isPlaying = true;
                audioPlayerContainer.classList.add('glow'); // Add glow class
            }
        }

        audioPlayer.onplay = updatePlayPauseIcon;
        audioPlayer.onpause = updatePlayPauseIcon;

        // Function to show session information for 5 seconds when clicked
        sessionInfoContainer.onclick = () => {
            sessionInfoContainer.style.display = 'flex';
            setTimeout(() => {
                sessionInfoContainer.style.display = 'none';
            }, 5000);
        };

        // Function to rename session ID
        renameSessionIdButton.addEventListener('click', function () {
            const newSessionId = prompt('Enter new session ID:');
            if (newSessionId && newSessionId.trim() !== '') {
                sessionId = newSessionId.trim();
                localStorage.setItem('sessionId', sessionId);
                sessionIdElement.textContent = sessionId;
                alert('Session ID renamed to: ' + sessionId);
            }
        });

        // Function to fetch current audio URL and play
        async function fetchAndUpdateAudioStatus() {
            try {
                const urlResponse = await fetch('https://helpful-gleaming-restaurant.glitch.me/current-url/' + sessionId);
                const data = await urlResponse.json();

                if (data.success && data.sessionId === sessionId) {
                    if (data.url !== audioPlayer.src) {
                        audioPlayer.src = data.url;
                    }
                    audioPlayer.volume = data.volume / 100;
                    if (data.action === 'play') {
                        audioPlayer.play();
                    } else if (data.action === 'pause') {
                        audioPlayer.pause();
                    } else if (data.action === 'stop') {
                        audioPlayer.pause();
                        audioPlayer.currentTime = 0;
                    } else if (data.action === 'volume') {
                        audioPlayer.volume = data.value / 100;
                    }
                } else {
                    console.error('Error fetching current URL:', data.error);
                }
            } catch (error) {
                console.error('Error fetching current URL:', error);
            }
        }

        // Fetch audio status every second
        setInterval(fetchAndUpdateAudioStatus, 1000);
    });
</script>

</body>
</html>

