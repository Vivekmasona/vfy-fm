<!doctype html>
<html lang="en">
<head>
  <meta content='#E74C3C' name='theme-color'/>
  <meta content='#E74C3C' name='msapplication-navbutto-color'/>
  <meta content='yes' name='apple-mobile-web-app-capable'/>
  <meta content='#E74C3C' name='apple-mobile-web-app-status-bar-style'/>
  <meta content='width=device-width, user-scalable=no' name='viewport'>
  <meta content='text/html; charset=UTF-8' http-equiv='Content-Type'/>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" />
  <style>
    body {
      margin: 0;
      padding: 0;
      background-size: cover;
      background-position: center;
      background-repeat: no-repeat;
      background-attachment: fixed;
      font-family: Arial, sans-serif;
      color: white;
      backdrop-filter: blur(2px); /* Add blur effect */
      transition: background-image 0.8s ease-in-out; /* Add smooth transition */
    }

    #searchBox {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 60px;
      background-color: rgba(0, 0, 0, 0.60);
      display: flex;
      align-items: center;
      padding: 0 20px;
      box-sizing: border-box;
    }

    #searchInput {
      width: calc(100% - 60px);
      height: 40px;
      padding: 10px;
      border: none;
      border-radius: 20px;
      background-color: #E74C3C;
      color: #E74C3C;
      font-size: 16px;
      outline: none;
      transition: background-color 0.3s ease-in-out;
    }

    #searchInput:focus {
      background-color: rgba(255, 255, 255, 0.4);
    }

    #searchButton {
      width: 60px;
      height: 40px;
      border: none;
      border-radius: 20px;
      background-color: #E74C3C;
      color: #fff;
      font-size: 16px;
      cursor: pointer;
      margin-left: 10px;
      outline: none;
      transition: background-color 0.3s ease-in-out;
    }

    #searchButton:hover {
      background-color: rgba(255, 255, 255, 0.4);
    }

    #footer {
      position: fixed;
      bottom: 0;
      left: 0;
      width: 100%;
      height: 60px;
      background-color: #333;
      display: flex;
      align-items: center;
      padding: 0 10px;
      box-sizing: border-box;
    }

    #poster {
      width: 50px;
      height: 50px;
      border-radius: 5px;
      margin-right: 10px;
    }

    #prevIcon,
    #playPauseIcon,
    #nextIcon,
    #micIcon {
      font-size: 24px;
      color: #E74C3C; /* Set icon color to E74C3C */
      cursor: pointer;
      margin: 0 10px;
    }

    #audioPlayer,
    #watermarkAudio {
      display: none; /* Initially hide watermark audio */
    }

    #currentSongTitle {
      position: absolute;
      top: 50%;
      left: 50%;
      background-color: rgba(0, 0, 0, 0.20);
      transform: translate(-50%, -50%);
      font-size: 24px;
      text-align: center;
      width: 100%;
    }

    #overlayListButton {
      position: fixed;
      bottom: 70px; /* Adjust as needed to position above the footer */
      right: 10px;
      background-color: rgba(0, 0, 0, 0.5);
      padding: 10px;
      border-radius: 50%;
      cursor: pointer;
      transition: background-color 0.3s ease-in-out;
    }

    #overlayListButton:hover {
      background-color: rgba(255, 255, 255, 0.2);
    }

    #overlayListButton i {
      color: #E74C3C;
      font-size: 24px;
    }

    #overlayListContainer {
      position: fixed;
      bottom: 140px; /* Adjust to align with the overlay list button */
      right: 0;
      width: 250px; /* Adjust width as needed */
      background-color: rgba(0, 0, 0, 0.8);
      border-top-left-radius: 10px;
      border-top-right-radius: 10px;
      overflow-y: auto; /* Enable scrolling if needed */
      max-height: calc(100vh - 200px); /* Adjust max height based on your layout */
      display: none; /* Hide initially */
    }

    #overlayListContainer.visible {
      display: block;
    }

    #overlayListContainer div {
      padding: 10px;
      color: white;
      border-bottom: 1px solid #555;
      cursor: pointer;
      transition: background-color 0.3s ease-in-out;
    }

    #overlayListContainer div:last-child {
      border-bottom: none;
    }

    #overlayListContainer div:hover {
      background-color: rgba(255, 255, 255, 0.1);
    }
  </style>
</head>
<body>
  <div id="searchBox">
    <input type="text" id="searchInput" placeholder="Vivekfy Song Store" />
    <button id="searchButton" onclick="searchSongs()"><i class="fas fa-search"></i></button>
  </div>

  <div id="searchResults"></div> <!-- Container for search results -->

  <div id="footer">
    <img id="poster" src="/img/newdp.png" alt="vivekmasona" />
    <i id="prevIcon" class="fas fa-step-backward" onclick="playPreviousSong()"></i>
    <i id="playPauseIcon" class="fas fa-play" onclick="togglePlayPause()"></i>
    <i id="nextIcon" class="fas fa-step-forward" onclick="playNextSong()"></i>
    <input type="range" id="seekBar" value="0" step="1" style="flex-grow: 1; background-color: #E74C3C;" /> <!-- Set seek bar color -->
    <i id="micIcon" class="fas fa-microphone"></i>
  </div>

  <p id="currentSongTitle"></p>

  <audio id="audioPlayer" controls=""></audio>

  <div id="overlayListButton">
    <i class="fas fa-list" onclick="toggleOverlayList()"></i>
  </div>

  <div id="overlayListContainer">
    <!-- List of songs will be dynamically added here -->
  </div>

  <script>
    var recognition = new webkitSpeechRecognition();
    var audioPlayer = document.getElementById('audioPlayer');
    var playPauseIcon = document.getElementById('playPauseIcon');
    var prevIcon = document.getElementById('prevIcon');
    var nextIcon = document.getElementById('nextIcon');
    var micIcon = document.getElementById('micIcon');
    var currentSongTitle = document.getElementById('currentSongTitle');
    var posterImage = document.getElementById('poster');
    var seekBar = document.getElementById('seekBar');
    var watermarkDiv = document.getElementById('watermark');
    var searchInput = document.getElementById('searchInput');
    var searchResults = document.getElementById('searchResults');
    var isPlaying = false;
    var playlist = [];
    var currentSongIndex = 0;

    // Function to play the next song in the playlist
    function playNextSong() {
      if (playlist.length > 0) {
        currentSongIndex = (currentSongIndex + 1) % playlist.length;
        playSongAtIndex(currentSongIndex);
      } else {
        console.log('No next song in the playlist.');
      }
    }

    // Function to play the previous song in the playlist
    function playPreviousSong() {
      if (playlist.length > 0) {
        currentSongIndex = (currentSongIndex - 1 + playlist.length) % playlist.length;
        playSongAtIndex(currentSongIndex);
      } else {
        console.log('No previous song in the playlist.');
      }
    }

    // Function to play a song at a specific index in the playlist
    function playSongAtIndex(index) {
      const song = playlist[index];
      const songUrl = song.downloadUrl[1]?.link;

      if (songUrl) {
        audioPlayer.src = songUrl;
        audioPlayer.play();
        playPauseIcon.className = 'fas fa-pause';
        isPlaying = true;

        // Display real-time playing song title
        currentSongTitle.textContent = song.name;

        // Display poster image and update background
        posterImage.src = song.poster;
        document.body.style.backgroundImage = `url('${song.poster}')`;
      } else {
        console.error('Invalid song URL.');
      }
    }

    // Function to toggle play/pause of the audio
    function togglePlayPause() {
      if (isPlaying) {
        audioPlayer.pause();
        playPauseIcon.className = 'fas fa-play';
      } else {
        audioPlayer.play();
        playPauseIcon.className = 'fas fa-pause';
      }
      isPlaying = !isPlaying;
    }

    // Function to handle search for songs
    function searchSongs() {
      const query = searchInput.value.trim();
      if (query === '') {
        alert('Please enter a search query.');
        return;
      }

      fetch(`https://vivekfy.vercel.app/audio?url=yturl&q=${query}`)
        .then(response => response.json())
        .then(data => {
          displaySearchResults(data);
        })
        .catch(error => {
          console.error('Error searching songs:', error);
          alert('Failed to fetch search results. Please try again later.');
        });
    }

    // Function to display search results
    function displaySearchResults(results) {
      searchResults.innerHTML = ''; // Clear previous results
      playlist = results.songs; // Update playlist with new results
      currentSongIndex = 0; // Reset current song index
      if (playlist.length > 0) {
        // Automatically play the first song
        playSongAtIndex(currentSongIndex);

        // Display search results
        playlist.forEach((song, index) => {
          const resultItem = document.createElement('div');
          resultItem.textContent = `${song.name} - ${song.artist}`;
          resultItem.addEventListener('click', () => {
            playSongAtIndex(index);
          });
          searchResults.appendChild(resultItem);
        });
      } else {
        alert('No songs found for the given query.');
      }
    }

    // Function to toggle the overlay list visibility
    function toggleOverlayList() {
      const overlayListContainer = document.getElementById('overlayListContainer');
      overlayListContainer.classList.toggle('visible');
    }

    // Event listener for the end of the audio playback
    audioPlayer.addEventListener('ended', () => {
      playNextSong(); // Automatically play the next song in the playlist
    });

    // Initial search for trending songs when the page loads
    window.onload = function() {
      searchSongs();
    };
  </script>
</body>
</html>
